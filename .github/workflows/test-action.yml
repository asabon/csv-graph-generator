name: Test Action

on:
  pull_request:
  workflow_dispatch:

jobs:
  test-graph-generation:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Force Dockerfile build (for testing changes)
        # This step modifies action.yml to point to 'Dockerfile' instead of the pre-built GHCR image.
        # This ensures that we are testing the code in the current PR, not the old released image.
        run: |
          sed -i 's|image: .docker://.*|image: "Dockerfile"|' action.yml

      - name: Generate Bar Chart
        id: bar-chart
        uses: ./
        with:
          csv-file: '.github/test-data/sample.csv'
          output-file: 'bar-chart.png'
          graph-type: 'bar'
          title: 'Monthly Sales (Bar)'

      - name: Generate Line Chart
        id: line-chart
        uses: ./
        with:
          csv-file: '.github/test-data/sample.csv'
          output-file: 'line-chart.png'
          graph-type: 'line'
          title: 'Monthly Sales (Line)'

      - name: Generate Pie Chart
        id: pie-chart
        uses: ./
        with:
          csv-file: '.github/test-data/sample.csv'
          output-file: 'pie-chart.png'
          graph-type: 'pie'
          title: 'Monthly Sales (Pie)'

      - name: Generate Doughnut Chart
        id: doughnut-chart
        uses: ./
        with:
          csv-file: '.github/test-data/sample.csv'
          output-file: 'doughnut-chart.png'
          graph-type: 'doughnut'
          title: 'Monthly Sales (Doughnut)'

      - name: Generate Radar Chart
        id: radar-chart
        uses: ./
        with:
          csv-file: '.github/test-data/sample.csv'
          output-file: 'radar-chart.png'
          graph-type: 'radar'
          title: 'Monthly Sales (Radar)'

      - name: Generate Polar Area Chart
        id: polar-area-chart
        uses: ./
        with:
          csv-file: '.github/test-data/sample.csv'
          output-file: 'polar-area-chart.png'
          graph-type: 'polarArea'
          title: 'Monthly Sales (Polar Area)'

      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: generated-graphs
          path: |
            # bar/line are already there, just need to make sure I don't delete them if they are above.
            # The replacement target includes 'bar-chart.png' etc in the 'target content' if I cover them.
            # The user provided lines 32-48. I will replace that block.
            bar-chart.png
            line-chart.png
            pie-chart.png
            doughnut-chart.png
            radar-chart.png
            polar-area-chart.png
